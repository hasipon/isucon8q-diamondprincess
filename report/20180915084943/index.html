
<!DOCTYPE HTML>
<html>
  <head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
  <script src="https://cdn.rawgit.com/google/code-prettify/master/loader/run_prettify.js?skin=desert"></script>
  <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
  <style></style>

      <script type="text/javascript">
      google.charts.load('current', {'packages':['corechart']});
      google.charts.setOnLoadCallback(drawChart);
      function drawChart() {
        var charts = document.getElementById('charts')
            var div = document.createElement("div");
            div.setAttribute("class", "col-md-4")
            charts.appendChild(div);
            var chart = new google.visualization.AreaChart(div);
            chart.draw(google.visualization.arrayToDataTable([['time', 'usr', 'sys', 'idl', 'wai'],
['15-09 17:48:27', 37.161, 5.724, 55.735, 0.566],
['15-09 17:48:28', 48.731, 10.66, 37.056, 2.03],
['15-09 17:48:29', 89.447, 8.543, 0.503, 0.0],
['15-09 17:48:30', 83.417, 10.05, 4.523, 0.0],
['15-09 17:48:31', 89.055, 8.955, 0.498, 0.0],
['15-09 17:48:32', 70.619, 17.526, 7.732, 0.515],
['15-09 17:48:33', 82.915, 12.06, 3.518, 0.0],
['15-09 17:48:34', 90.863, 7.614, 0.508, 0.0],
['15-09 17:48:35', 83.5, 12.5, 1.5, 0.0],
['15-09 17:48:36', 89.0, 8.0, 1.0, 0.0],
['15-09 17:48:37', 70.256, 16.923, 9.744, 0.513],
['15-09 17:48:38', 63.59, 17.949, 14.872, 0.0],
['15-09 17:48:39', 93.532, 4.975, 0.498, 0.0],
['15-09 17:48:40', 94.975, 3.518, 1.005, 0.0],
['15-09 17:48:41', 87.817, 8.629, 2.538, 0.0],
['15-09 17:48:42', 71.574, 18.274, 7.614, 0.0],
['15-09 17:48:43', 89.109, 8.416, 0.495, 0.0],
['15-09 17:48:44', 80.412, 12.371, 5.155, 0.0],
['15-09 17:48:45', 63.212, 20.207, 13.472, 0.0],
['15-09 17:48:46', 61.735, 17.857, 16.837, 0.0],
['15-09 17:48:47', 83.249, 9.645, 5.584, 0.0],
['15-09 17:48:48', 86.5, 9.5, 1.5, 0.0],
['15-09 17:48:49', 81.726, 12.183, 4.061, 0.0],
['15-09 17:48:50', 89.0, 9.0, 0.5, 0.0],
['15-09 17:48:51', 89.5, 8.5, 0.5, 0.0],
['15-09 17:48:52', 94.949, 3.535, 1.01, 0.0],
['15-09 17:48:53', 96.535, 2.475, 0.495, 0.0],
['15-09 17:48:54', 79.188, 13.198, 5.076, 0.508],
['15-09 17:48:55', 63.077, 19.487, 14.872, 0.0],
['15-09 17:48:56', 63.59, 19.487, 14.359, 0.0],
['15-09 17:48:57', 87.374, 9.091, 2.02, 0.0],
['15-09 17:48:58', 92.0, 5.5, 1.5, 0.0],
['15-09 17:48:59', 67.005, 12.69, 17.259, 0.0],
['15-09 17:49:00', 88.325, 9.137, 1.015, 0.0],
['15-09 17:49:01', 84.653, 10.891, 2.475, 0.0],
['15-09 17:49:02', 67.876, 17.617, 11.399, 0.518],
['15-09 17:49:03', 69.948, 15.026, 12.953, 0.0],
['15-09 17:49:04', 67.526, 17.526, 11.856, 0.0],
['15-09 17:49:05', 65.979, 15.979, 14.948, 0.0],
['15-09 17:49:06', 68.367, 17.347, 11.735, 0.0],
['15-09 17:49:07', 76.142, 13.198, 8.629, 0.0],
['15-09 17:49:08', 89.34, 7.614, 1.015, 0.0],
['15-09 17:49:09', 85.354, 11.111, 1.515, 0.0],
['15-09 17:49:10', 66.839, 15.544, 14.508, 0.0],
['15-09 17:49:11', 67.179, 14.872, 14.359, 0.513],
['15-09 17:49:12', 65.803, 16.062, 14.508, 0.0],
['15-09 17:49:13', 71.574, 15.736, 9.645, 0.0],
['15-09 17:49:14', 68.557, 14.948, 13.402, 0.0],
['15-09 17:49:15', 84.848, 10.606, 2.525, 0.0],
['15-09 17:49:16', 90.955, 7.538, 0.503, 0.0],
['15-09 17:49:17', 96.04, 3.465, 0.0, 0.0],
['15-09 17:49:18', 95.477, 3.015, 0.503, 0.0],
['15-09 17:49:19', 93.939, 4.04, 0.505, 0.0],
['15-09 17:49:20', 86.567, 10.945, 0.498, 0.0],
['15-09 17:49:21', 51.795, 16.41, 28.205, 0.0],
['15-09 17:49:22', 63.5, 16.0, 17.0, 0.0],
['15-09 17:49:23', 74.093, 18.135, 5.699, 0.0],
['15-09 17:49:24', 88.945, 7.035, 3.015, 0.0],
['15-09 17:49:25', 96.5, 1.5, 2.0, 0.0],
['15-09 17:49:26', 97.487, 1.005, 1.005, 0.0],
]), {
                title: 'cpu',
	        width: 400,
	        height: 240,
                vAxis: {minValue: 0},
	        legend: {position: 'top', maxLines: 3},
                backgroundColor: { fill:'transparent' },
                isStacked: true,
            });
            var div = document.createElement("div");
            div.setAttribute("class", "col-md-4")
            charts.appendChild(div);
            var chart = new google.visualization.AreaChart(div);
            chart.draw(google.visualization.arrayToDataTable([['time', 'used', 'buff', 'cach', 'free'],
['15-09 17:48:27', 375861248.0, 10985472.0, 285908992.0, 367005696.0],
['15-09 17:48:28', 406335488.0, 11022336.0, 285986816.0, 336416768.0],
['15-09 17:48:29', 459649024.0, 11026432.0, 286539776.0, 282546176.0],
['15-09 17:48:30', 513466368.0, 11190272.0, 286265344.0, 228839424.0],
['15-09 17:48:31', 514043904.0, 11206656.0, 286412800.0, 228098048.0],
['15-09 17:48:32', 540401664.0, 11321344.0, 286564352.0, 201474048.0],
['15-09 17:48:33', 576016384.0, 11337728.0, 286785536.0, 165621760.0],
['15-09 17:48:34', 575909888.0, 11354112.0, 286916608.0, 165580800.0],
['15-09 17:48:35', 576188416.0, 11395072.0, 287404032.0, 164773888.0],
['15-09 17:48:36', 576217088.0, 11423744.0, 288833536.0, 163287040.0],
['15-09 17:48:37', 576602112.0, 11452416.0, 288935936.0, 162770944.0],
['15-09 17:48:38', 576847872.0, 11460608.0, 289124352.0, 162328576.0],
['15-09 17:48:39', 576978944.0, 11468800.0, 289210368.0, 162103296.0],
['15-09 17:48:40', 611913728.0, 11476992.0, 289234944.0, 127135744.0],
['15-09 17:48:41', 683827200.0, 11067392.0, 278589440.0, 66277376.0],
['15-09 17:48:42', 700698624.0, 11079680.0, 241041408.0, 86941696.0],
['15-09 17:48:43', 701128704.0, 11091968.0, 241106944.0, 86433792.0],
['15-09 17:48:44', 702287872.0, 11104256.0, 241168384.0, 85200896.0],
['15-09 17:48:45', 702431232.0, 11112448.0, 241360896.0, 84856832.0],
['15-09 17:48:46', 702332928.0, 11120640.0, 242032640.0, 84275200.0],
['15-09 17:48:47', 703008768.0, 11128832.0, 241631232.0, 83992576.0],
['15-09 17:48:48', 704405504.0, 11145216.0, 245436416.0, 78774272.0],
['15-09 17:48:49', 705220608.0, 11161600.0, 245710848.0, 77668352.0],
['15-09 17:48:50', 705814528.0, 11173888.0, 246550528.0, 76222464.0],
['15-09 17:48:51', 705576960.0, 9687040.0, 248803328.0, 75694080.0],
['15-09 17:48:52', 706109440.0, 9830400.0, 234041344.0, 89780224.0],
['15-09 17:48:53', 705724416.0, 9838592.0, 234070016.0, 90128384.0],
['15-09 17:48:54', 709898240.0, 9793536.0, 219013120.0, 101056512.0],
['15-09 17:48:55', 710877184.0, 9826304.0, 219201536.0, 99856384.0],
['15-09 17:48:56', 707887104.0, 9859072.0, 219807744.0, 102207488.0],
['15-09 17:48:57', 708804608.0, 9883648.0, 219521024.0, 101552128.0],
['15-09 17:48:58', 708460544.0, 10203136.0, 219635712.0, 101462016.0],
['15-09 17:48:59', 708395008.0, 10231808.0, 219668480.0, 101466112.0],
['15-09 17:49:00', 707993600.0, 10264576.0, 220979200.0, 100524032.0],
['15-09 17:49:01', 708452352.0, 10293248.0, 234835968.0, 86179840.0],
['15-09 17:49:02', 708157440.0, 10338304.0, 220356608.0, 100909056.0],
['15-09 17:49:03', 708575232.0, 10366976.0, 220180480.0, 100638720.0],
['15-09 17:49:04', 708628480.0, 10391552.0, 221433856.0, 99307520.0],
['15-09 17:49:05', 708886528.0, 10416128.0, 220438528.0, 100020224.0],
['15-09 17:49:06', 708919296.0, 10440704.0, 220581888.0, 99819520.0],
['15-09 17:49:07', 709136384.0, 10481664.0, 220913664.0, 99229696.0],
['15-09 17:49:08', 711319552.0, 10489856.0, 220790784.0, 97161216.0],
['15-09 17:49:09', 711417856.0, 10502144.0, 235618304.0, 82223104.0],
['15-09 17:49:10', 711753728.0, 10510336.0, 221106176.0, 96391168.0],
['15-09 17:49:11', 711929856.0, 10518528.0, 221159424.0, 96153600.0],
['15-09 17:49:12', 711991296.0, 10526720.0, 221294592.0, 95948800.0],
['15-09 17:49:13', 713183232.0, 10534912.0, 221560832.0, 94482432.0],
['15-09 17:49:14', 714301440.0, 10543104.0, 221605888.0, 93310976.0],
['15-09 17:49:15', 715173888.0, 10551296.0, 221732864.0, 92303360.0],
['15-09 17:49:16', 715087872.0, 10559488.0, 221806592.0, 92307456.0],
['15-09 17:49:17', 715051008.0, 10571776.0, 222638080.0, 91500544.0],
['15-09 17:49:18', 716836864.0, 10584064.0, 222507008.0, 89833472.0],
['15-09 17:49:19', 718278656.0, 10592256.0, 222560256.0, 88330240.0],
['15-09 17:49:20', 718454784.0, 10608640.0, 241872896.0, 68825088.0],
['15-09 17:49:21', 715812864.0, 10625024.0, 222830592.0, 90492928.0],
['15-09 17:49:22', 717602816.0, 10633216.0, 223031296.0, 88494080.0],
['15-09 17:49:23', 716533760.0, 10641408.0, 223248384.0, 89337856.0],
['15-09 17:49:24', 717045760.0, 10665984.0, 223346688.0, 88702976.0],
['15-09 17:49:25', 717176832.0, 10690560.0, 223379456.0, 88514560.0],
['15-09 17:49:26', 723099648.0, 10715136.0, 223612928.0, 82333696.0],
]), {
                title: 'mem',
	        width: 400,
	        height: 240,
                vAxis: {minValue: 0, format: 'short'},
	        legend: {position: 'top', maxLines: 3},
                backgroundColor: { fill:'transparent' },
            });
            var div = document.createElement("div");
            div.setAttribute("class", "col-md-4")
            charts.appendChild(div);
            var chart = new google.visualization.AreaChart(div);
            chart.draw(google.visualization.arrayToDataTable([['time', 'recv', 'send'],
['15-09 17:48:27', 0.0, 0.0],
['15-09 17:48:28', 90693.0, 5252372.0],
['15-09 17:48:29', 133554.0, 10664233.0],
['15-09 17:48:30', 141916.0, 23670049.0],
['15-09 17:48:31', 105232.0, 8264166.0],
['15-09 17:48:32', 214301.0, 30432132.0],
['15-09 17:48:33', 147100.0, 12654108.0],
['15-09 17:48:34', 106169.0, 8674718.0],
['15-09 17:48:35', 184611.0, 26414238.0],
['15-09 17:48:36', 131551.0, 9366450.0],
['15-09 17:48:37', 265004.0, 31023223.0],
['15-09 17:48:38', 266143.0, 19417392.0],
['15-09 17:48:39', 64934.0, 4843919.0],
['15-09 17:48:40', 10622.0, 457511.0],
['15-09 17:48:41', 57571.0, 14860141.0],
['15-09 17:48:42', 228776.0, 30749588.0],
['15-09 17:48:43', 95088.0, 6414559.0],
['15-09 17:48:44', 177934.0, 24170283.0],
['15-09 17:48:45', 298684.0, 21871262.0],
['15-09 17:48:46', 212631.0, 12863386.0],
['15-09 17:48:47', 120702.0, 6332857.0],
['15-09 17:48:48', 142309.0, 8652211.0],
['15-09 17:48:49', 178013.0, 26044079.0],
['15-09 17:48:50', 99139.0, 5795155.0],
['15-09 17:48:51', 130892.0, 22519663.0],
['15-09 17:48:52', 33858.0, 2794512.0],
['15-09 17:48:53', 24484.0, 1662563.0],
['15-09 17:48:54', 170526.0, 38828587.0],
['15-09 17:48:55', 225739.0, 13010820.0],
['15-09 17:48:56', 211520.0, 12180853.0],
['15-09 17:48:57', 150550.0, 8174939.0],
['15-09 17:48:58', 94241.0, 7570004.0],
['15-09 17:48:59', 203716.0, 27068633.0],
['15-09 17:49:00', 151594.0, 8824994.0],
['15-09 17:49:01', 148539.0, 15425003.0],
['15-09 17:49:02', 298698.0, 26293339.0],
['15-09 17:49:03', 228893.0, 14666504.0],
['15-09 17:49:04', 249145.0, 13942245.0],
['15-09 17:49:05', 214274.0, 11626785.0],
['15-09 17:49:06', 265840.0, 15617400.0],
['15-09 17:49:07', 220184.0, 11586940.0],
['15-09 17:49:08', 149951.0, 9738467.0],
['15-09 17:49:09', 193511.0, 22373062.0],
['15-09 17:49:10', 253862.0, 18785332.0],
['15-09 17:49:11', 260774.0, 16885731.0],
['15-09 17:49:12', 257895.0, 15094957.0],
['15-09 17:49:13', 288482.0, 19177109.0],
['15-09 17:49:14', 299521.0, 19255538.0],
['15-09 17:49:15', 220335.0, 14473019.0],
['15-09 17:49:16', 97804.0, 5958739.0],
['15-09 17:49:17', 41579.0, 3821799.0],
['15-09 17:49:18', 55643.0, 13717840.0],
['15-09 17:49:19', 121176.0, 7146331.0],
['15-09 17:49:20', 220572.0, 27618544.0],
['15-09 17:49:21', 167484.0, 22253468.0],
['15-09 17:49:22', 236591.0, 15002956.0],
['15-09 17:49:23', 248457.0, 15812104.0],
['15-09 17:49:24', 45097.0, 2616174.0],
['15-09 17:49:25', 10248.0, 540659.0],
['15-09 17:49:26', 9809.0, 7425.0],
]), {
                title: 'net',
	        width: 400,
	        height: 240,
                vAxis: {minValue: 0},
	        legend: {position: 'top', maxLines: 3},
                backgroundColor: { fill:'transparent' },
            });
     }
     </script>
    
      <script type="text/javascript">
      google.charts.load('current', {'packages':['corechart']});
      google.charts.setOnLoadCallback(drawChart);
      function drawChart() {
        var charts = document.getElementById('charts')
            var div = document.createElement("div");
            div.setAttribute("class", "col-md-4")
            charts.appendChild(div);
            var chart = new google.visualization.AreaChart(div);
            chart.draw(google.visualization.arrayToDataTable([['Time', 'mysqld', 'mysqld_safe', 'nginx', 'torb'],
['1537001351', 65.0, 0.0, 7.0, 92.0],
['1537001350', 53.0, 0.0, 7.0, 100.0],
['1537001353', 66.0, 0.0, 7.0, 92.0],
['1537001352', 62.0, 0.0, 7.0, 100.0],
['1537001355', 61.0, 0.0, 6.0, 100.0],
['1537001354', 63.37, 0.0, 7.92, 100.0],
['1537001357', 63.37, 0.0, 1.98, 100.0],
['1537001356', 57.0, 0.0, 5.0, 100.0],
['1537001359', 51.49, 0.0, 2.97, 100.0],
['1537001358', 37.0, 0.0, 1.0, 100.0],
['1537001366', 52.0, 0.0, 0.0, 100.0],
['1537001367', 26.0, 0.0, 5.0, 100.0],
['1537001360', 46.0, 0.0, 3.0, 100.0],
['1537001361', 35.0, 0.0, 9.0, 100.0],
['1537001338', 45.54, 0.0, 1.98, 100.0],
['1537001362', 73.0, 0.0, 4.0, 50.0],
['1537001363', 64.0, 0.0, 6.0, 94.0],
['1537001333', 46.0, 0.0, 1.0, 100.0],
['1537001320', 51.49, 0.0, 0.0, 100.0],
['1537001321', 24.0, 0.0, 7.0, 100.0],
['1537001322', 80.0, 0.0, 6.0, 94.0],
['1537001323', 62.0, 0.0, 3.0, 100.0],
['1537001324', 57.43, 0.0, 7.92, 100.0],
['1537001325', 82.0, 0.0, 8.0, 76.0],
['1537001326', 80.0, 0.0, 7.0, 76.0],
['1537001327', 66.0, 0.0, 4.0, 100.0],
['1537001328', 59.0, 0.0, 4.0, 100.0],
['1537001329', 56.0, 0.0, 7.0, 100.0],
['1537001332', 51.49, 0.0, 1.98, 100.0],
['1537001342', 73.0, 0.0, 7.0, 89.0],
['1537001343', 70.0, 0.0, 6.0, 96.0],
['1537001340', 61.39, 0.0, 3.96, 100.0],
['1537001341', 53.0, 0.0, 6.0, 100.0],
['1537001346', 75.0, 0.0, 6.0, 90.0],
['1537001308', 45.1, 0.0, 2.94, 58.82],
['1537001344', 78.0, 0.0, 6.0, 87.0],
['1537001345', 66.34, 0.0, 6.93, 93.07],
['1537001348', 66.0, 0.0, 5.0, 100.0],
['1537001309', 58.42, 0.0, 3.96, 100.0],
['1537001364', 66.0, 0.0, 7.0, 97.0],
['1537001339', 60.0, 0.0, 8.0, 92.0],
['1537001349', 59.0, 0.0, 3.0, 100.0],
['1537001365', 55.45, 0.0, 0.99, 100.0],
['1537001337', 58.0, 0.0, 3.0, 100.0],
['1537001336', 74.26, 0.0, 6.93, 81.19],
['1537001335', 72.0, 0.0, 6.0, 80.0],
['1537001334', 45.0, 0.0, 9.0, 100.0],
['1537001319', 58.0, 0.0, 2.0, 100.0],
['1537001318', 73.27, 0.0, 6.93, 84.16],
['1537001331', 50.0, 0.0, 5.0, 100.0],
['1537001330', 61.39, 0.0, 2.97, 100.0],
['1537001315', 64.0, 0.0, 6.0, 100.0],
['1537001314', 56.44, 0.0, 2.97, 100.0],
['1537001317', 67.0, 0.0, 10.0, 98.0],
['1537001316', 59.0, 0.0, 4.0, 100.0],
['1537001311', 63.37, 0.0, 2.97, 100.0],
['1537001310', 53.47, 0.0, 5.94, 100.0],
['1537001313', 65.0, 0.0, 4.0, 100.0],
['1537001312', 56.0, 0.0, 9.0, 100.0],
]), {
                title: '%cpu',
	        width: 400,
	        height: 240,
                vAxis: {minValue: 0},
	        legend: {position: 'top', maxLines: 3},
                backgroundColor: { fill:'transparent' },
                isStacked: true,
            });
            var div = document.createElement("div");
            div.setAttribute("class", "col-md-4")
            charts.appendChild(div);
            var chart = new google.visualization.AreaChart(div);
            chart.draw(google.visualization.arrayToDataTable([['Time', 'mysqld', 'mysqld_safe', 'nginx', 'torb'],
['1537001351', 18.39, 0.16, 0.47, 40.67],
['1537001350', 18.39, 0.16, 0.47, 40.67],
['1537001353', 18.39, 0.16, 0.47, 40.67],
['1537001352', 18.39, 0.16, 0.47, 40.67],
['1537001355', 18.57, 0.16, 0.48, 40.67],
['1537001354', 18.51, 0.16, 0.47, 40.67],
['1537001357', 18.66, 0.16, 0.48, 40.67],
['1537001356', 18.65, 0.16, 0.48, 40.67],
['1537001359', 18.66, 0.16, 0.5, 40.67],
['1537001358', 18.66, 0.16, 0.48, 40.67],
['1537001366', 18.78, 0.16, 0.5, 40.67],
['1537001367', 18.78, 0.16, 0.5, 41.39],
['1537001360', 18.66, 0.16, 0.5, 40.67],
['1537001361', 18.7, 0.16, 0.5, 40.67],
['1537001338', 18.21, 0.16, 0.46, 40.67],
['1537001362', 18.7, 0.16, 0.5, 40.67],
['1537001363', 18.78, 0.16, 0.5, 40.67],
['1537001333', 18.14, 0.16, 0.46, 40.21],
['1537001320', 18.02, 0.16, 0.46, 31.53],
['1537001321', 18.02, 0.16, 0.46, 38.47],
['1537001322', 18.05, 0.16, 0.46, 40.04],
['1537001323', 18.05, 0.16, 0.46, 40.08],
['1537001324', 18.07, 0.16, 0.46, 40.19],
['1537001325', 18.07, 0.16, 0.46, 40.19],
['1537001326', 18.07, 0.16, 0.46, 40.19],
['1537001327', 18.07, 0.16, 0.46, 40.19],
['1537001328', 18.07, 0.16, 0.46, 40.19],
['1537001329', 18.07, 0.16, 0.46, 40.21],
['1537001332', 18.11, 0.16, 0.46, 40.21],
['1537001342', 18.21, 0.16, 0.46, 40.67],
['1537001343', 18.21, 0.16, 0.46, 40.67],
['1537001340', 18.21, 0.16, 0.46, 40.67],
['1537001341', 18.21, 0.16, 0.46, 40.67],
['1537001346', 18.21, 0.16, 0.46, 40.67],
['1537001308', 17.87, 0.16, 0.43, 12.01],
['1537001344', 18.21, 0.16, 0.46, 40.67],
['1537001345', 18.21, 0.16, 0.46, 40.67],
['1537001348', 18.21, 0.16, 0.46, 40.67],
['1537001309', 17.92, 0.16, 0.45, 17.12],
['1537001364', 18.78, 0.16, 0.5, 40.67],
['1537001339', 18.21, 0.16, 0.46, 40.67],
['1537001349', 18.33, 0.16, 0.47, 40.67],
['1537001365', 18.78, 0.16, 0.5, 40.67],
['1537001337', 18.21, 0.16, 0.46, 40.67],
['1537001336', 18.21, 0.16, 0.46, 40.67],
['1537001335', 18.21, 0.16, 0.46, 40.65],
['1537001334', 18.14, 0.16, 0.46, 40.65],
['1537001319', 18.02, 0.16, 0.46, 28.17],
['1537001318', 18.02, 0.16, 0.46, 28.17],
['1537001331', 18.11, 0.16, 0.46, 40.21],
['1537001330', 18.07, 0.16, 0.46, 40.21],
['1537001315', 18.0, 0.16, 0.46, 28.15],
['1537001314', 18.0, 0.16, 0.46, 28.1],
['1537001317', 18.02, 0.16, 0.46, 28.17],
['1537001316', 18.0, 0.16, 0.46, 28.17],
['1537001311', 17.94, 0.16, 0.45, 22.25],
['1537001310', 17.94, 0.16, 0.45, 22.23],
['1537001313', 18.0, 0.16, 0.46, 28.08],
['1537001312', 17.97, 0.16, 0.46, 24.74],
]), {
                title: '%mem',
	        width: 400,
	        height: 240,
                vAxis: {minValue: 0},
	        legend: {position: 'top', maxLines: 3},
                backgroundColor: { fill:'transparent' },
                isStacked: true,
            });
            var div = document.createElement("div");
            div.setAttribute("class", "col-md-4")
            charts.appendChild(div);
            var chart = new google.visualization.AreaChart(div);
            chart.draw(google.visualization.arrayToDataTable([['Seq', 'CLOSE_WAIT', 'ESTABLISHED', 'FIN_WAIT1', 'FIN_WAIT2', 'LISTEN', 'SYN_RECV', 'SYN_SENT', 'TIME_WAIT'],
[0, 0, 10, 0, 0, 9, 0, 0, 13],
[1, 0, 47, 0, 0, 9, 0, 0, 47],
[2, 0, 51, 0, 0, 9, 0, 0, 79],
[3, 1, 46, 1, 0, 9, 0, 0, 3],
[4, 0, 51, 0, 0, 9, 0, 0, 35],
[5, 1, 58, 1, 0, 9, 0, 0, 199],
[6, 0, 54, 0, 0, 9, 0, 0, 97],
[7, 0, 50, 0, 0, 9, 0, 0, 43],
[8, 0, 61, 0, 0, 9, 0, 0, 76],
[9, 0, 49, 0, 0, 9, 0, 0, 88],
[10, 0, 50, 1, 0, 9, 0, 0, 25],
[11, 0, 55, 0, 0, 9, 0, 0, 82],
[12, 0, 54, 0, 0, 9, 0, 0, 14],
[13, 1, 46, 1, 0, 9, 0, 0, 3],
[14, 1, 43, 1, 0, 9, 0, 0, 100],
[15, 0, 43, 0, 0, 9, 0, 0, 53],
[16, 0, 44, 0, 0, 9, 0, 0, 109],
[17, 2, 45, 3, 0, 9, 0, 0, 94],
[18, 0, 36, 0, 0, 9, 0, 0, 161],
[19, 0, 46, 0, 0, 9, 0, 0, 221],
[20, 0, 55, 0, 0, 9, 0, 0, 37],
[21, 1, 38, 1, 0, 9, 0, 0, 81],
[22, 0, 48, 0, 0, 9, 0, 0, 98],
[23, 0, 53, 0, 0, 9, 0, 0, 38],
[24, 0, 55, 0, 0, 9, 0, 0, 12],
[25, 0, 47, 0, 0, 9, 0, 0, 25],
[26, 0, 39, 0, 0, 9, 0, 0, 3],
[27, 1, 50, 0, 0, 9, 0, 0, 100],
[28, 0, 45, 0, 0, 9, 0, 0, 144],
[29, 0, 48, 1, 0, 9, 4, 0, 143],
[30, 0, 46, 0, 0, 9, 0, 0, 17],
[31, 0, 27, 0, 0, 9, 0, 0, 112],
[32, 1, 47, 1, 0, 9, 0, 0, 108],
[33, 1, 50, 1, 0, 9, 0, 0, 13],
[34, 1, 49, 3, 0, 9, 0, 0, 112],
[35, 0, 48, 0, 0, 9, 0, 0, 171],
[36, 0, 45, 0, 0, 9, 0, 0, 14],
[37, 0, 47, 0, 0, 9, 0, 0, 86],
[38, 0, 62, 0, 0, 9, 0, 0, 162],
[39, 0, 75, 0, 0, 9, 0, 0, 2],
[40, 1, 113, 2, 0, 9, 0, 0, 37],
[41, 0, 100, 0, 0, 9, 0, 0, 74],
[42, 0, 97, 0, 0, 9, 0, 0, 198],
[43, 0, 95, 0, 0, 9, 0, 0, 80],
[44, 0, 108, 0, 0, 9, 0, 0, 143],
[45, 1, 111, 1, 0, 9, 0, 0, 134],
[46, 0, 153, 1, 0, 9, 0, 0, 73],
[47, 0, 196, 0, 0, 9, 0, 0, 87],
[48, 0, 193, 0, 0, 9, 0, 0, 4],
[49, 0, 192, 0, 0, 9, 0, 0, 5],
[50, 16, 148, 0, 15, 9, 0, 0, 8],
[51, 40, 214, 0, 40, 9, 0, 0, 81],
[52, 19, 181, 0, 20, 9, 0, 0, 28],
[53, 0, 123, 0, 0, 9, 0, 0, 100],
[54, 0, 195, 0, 0, 9, 0, 1, 257],
[55, 0, 201, 0, 0, 9, 0, 0, 119],
[56, 0, 198, 0, 0, 9, 0, 0, 19],
[57, 4, 181, 0, 4, 9, 0, 0, 8],
]), {
                title: 'tcp',
	        width: 400,
	        height: 240,
                vAxis: {minValue: 0, format: 'short'},
	        legend: {position: 'top', maxLines: 3},
                backgroundColor: { fill:'transparent' },
            });
     }
     </script>
    
  </head>
  <body>
  <div class="container">
	<h1>Benchmark Report</h1>
	<div id="charts" class="row"></div>
<h2>Bench Output</h2><pre class="prettyprint">JobId	15462
Target	172.17.130.2
Score	34,437
Status	pass
State	done
UpdatedAt	17:49:31
Message	ok
Log	09/15 17:48:29 負荷レベルが上昇しました。
 09/15 17:48:30 レスポンスが遅いため負荷レベルを上げられませんでした。/admin/api/reports/sales
 09/15 17:48:31 レスポンスが遅いため負荷レベルを上げられませんでした。/admin/api/reports/sales
 09/15 17:48:32 レスポンスが遅いため負荷レベルを上げられませんでした。/admin/api/reports/sales
 09/15 17:48:33 レスポンスが遅いため負荷レベルを上げられませんでした。/admin/api/reports/sales
 09/15 17:48:34 レスポンスが遅いため負荷レベルを上げられませんでした。/admin/api/reports/sales
 09/15 17:48:35 レスポンスが遅いため負荷レベルを上げられませんでした。/admin/api/reports/sales
 09/15 17:48:36 レスポンスが遅いため負荷レベルを上げられませんでした。/admin/api/reports/sales
 09/15 17:48:37 レスポンスが遅いため負荷レベルを上げられませんでした。/admin/api/reports/sales
 09/15 17:48:38 レスポンスが遅いため負荷レベルを上げられませんでした。/admin/api/reports/sales
 09/15 17:48:39 レスポンスが遅いため負荷レベルを上げられませんでした。/admin/api/reports/sales
 09/15 17:48:40 レスポンスが遅いため負荷レベルを上げられませんでした。/admin/api/reports/sales
 09/15 17:48:41 レスポンスが遅いため負荷レベルを上げられませんでした。/api/events/11/actions/reserve
 09/15 17:48:42 レスポンスが遅いため負荷レベルを上げられませんでした。/api/events/11/actions/reserve
 09/15 17:48:43 レスポンスが遅いため負荷レベルを上げられませんでした。/api/events/11/actions/reserve
 09/15 17:48:44 レスポンスが遅いため負荷レベルを上げられませんでした。/admin/api/reports/sales
 09/15 17:48:45 レスポンスが遅いため負荷レベルを上げられませんでした。/admin/api/reports/sales
 09/15 17:48:46 レスポンスが遅いため負荷レベルを上げられませんでした。/admin/api/reports/sales
 09/15 17:48:47 レスポンスが遅いため負荷レベルを上げられませんでした。/admin/api/reports/sales
 09/15 17:48:48 レスポンスが遅いため負荷レベルを上げられませんでした。/admin/api/reports/sales
 09/15 17:48:49 レスポンスが遅いため負荷レベルを上げられませんでした。/admin/api/reports/sales
 09/15 17:48:50 レスポンスが遅いため負荷レベルを上げられませんでした。/admin/api/reports/sales
 09/15 17:48:51 レスポンスが遅いため負荷レベルを上げられませんでした。/admin/api/reports/sales
 09/15 17:48:52 レスポンスが遅いため負荷レベルを上げられませんでした。/admin/api/reports/sales
 09/15 17:48:53 レスポンスが遅いため負荷レベルを上げられませんでした。/admin/api/reports/sales
 09/15 17:48:54 レスポンスが遅いため負荷レベルを上げられませんでした。/admin/api/reports/sales
 09/15 17:48:55 レスポンスが遅いため負荷レベルを上げられませんでした。/admin/api/reports/sales
 09/15 17:48:56 レスポンスが遅いため負荷レベルを上げられませんでした。/admin/api/reports/sales
 09/15 17:48:57 レスポンスが遅いため負荷レベルを上げられませんでした。/admin/api/reports/sales
 09/15 17:48:58 レスポンスが遅いため負荷レベルを上げられませんでした。/admin/api/reports/sales
 09/15 17:48:59 レスポンスが遅いため負荷レベルを上げられませんでした。/admin/api/reports/sales
 09/15 17:49:00 レスポンスが遅いため負荷レベルを上げられませんでした。/admin/api/reports/sales
 09/15 17:49:01 レスポンスが遅いため負荷レベルを上げられませんでした。/admin/api/reports/sales
 09/15 17:49:02 レスポンスが遅いため負荷レベルを上げられませんでした。/admin/api/reports/sales
 09/15 17:49:03 レスポンスが遅いため負荷レベルを上げられませんでした。/admin/api/reports/sales
 09/15 17:49:04 レスポンスが遅いため負荷レベルを上げられませんでした。/admin/api/reports/sales
 09/15 17:49:05 レスポンスが遅いため負荷レベルを上げられませんでした。/admin/api/reports/sales
 09/15 17:49:06 負荷レベルが上昇しました。
 09/15 17:49:07 負荷レベルが上昇しました。
 09/15 17:49:08 負荷レベルが上昇しました。
 09/15 17:49:09 レスポンスが遅いため負荷レベルを上げられませんでした。/admin/api/reports/sales
 09/15 17:49:10 レスポンスが遅いため負荷レベルを上げられませんでした。/admin/api/reports/sales
 09/15 17:49:11 レスポンスが遅いため負荷レベルを上げられませんでした。/admin/api/reports/sales
 09/15 17:49:12 レスポンスが遅いため負荷レベルを上げられませんでした。/admin/api/reports/sales
 09/15 17:49:13 レスポンスが遅いため負荷レベルを上げられませんでした。/admin/api/reports/sales
 09/15 17:49:14 負荷レベルが上昇しました。
 09/15 17:49:15 負荷レベルが上昇しました。
 09/15 17:49:16 レスポンスが遅いため負荷レベルを上げられませんでした。/api/events/11/sheets/B/134/reservation
 09/15 17:49:17 レスポンスが遅いため負荷レベルを上げられませんでした。/api/events/11/actions/reserve
 09/15 17:49:18 レスポンスが遅いため負荷レベルを上げられませんでした。/api/events/11/actions/reserve
 09/15 17:49:19 エラーが発生したため負荷レベルを上げられませんでした。2018-09-15 17:49:19.480285529 +0900 JST m=+56.176343567 リクエストがタイムアウトしました (POST /api/events/11/actions/reserve )
 09/15 17:49:20 エラーが発生したため負荷レベルを上げられませんでした。2018-09-15 17:49:20.473998604 +0900 JST m=+57.170056541 リクエストがタイムアウトしました (POST /api/events/11/actions/reserve )
 09/15 17:49:21 エラーが発生したため負荷レベルを上げられませんでした。2018-09-15 17:49:21.368113149 +0900 JST m=+58.064171107 リクエストがタイムアウトしました (POST /api/events/11/actions/reserve )
 09/15 17:49:22 エラーが発生したため負荷レベルを上げられませんでした。2018-09-15 17:49:21.368113149 +0900 JST m=+58.064171107 リクエストがタイムアウトしました (POST /api/events/11/actions/reserve )
 09/15 17:49:23 エラーが発生したため負荷レベルを上げられませんでした。2018-09-15 17:49:21.368113149 +0900 JST m=+58.064171107 リクエストがタイムアウトしました (POST /api/events/11/actions/reserve )
 09/15 17:49:24 エラーが発生したため負荷レベルを上げられませんでした。2018-09-15 17:49:21.368113149 +0900 JST m=+58.064171107 リクエストがタイムアウトしました (POST /api/events/11/actions/reserve )
 09/15 17:49:25 エラーが発生したため負荷レベルを上げられませんでした。2018-09-15 17:49:21.368113149 +0900 JST m=+58.064171107 リクエストがタイムアウトしました (POST /api/events/11/actions/reserve )
 09/15 17:49:26 エラーが発生したため負荷レベルを上げられませんでした。2018-09-15 17:49:26.392037663 +0900 JST m=+63.088095639 リクエストがタイムアウトしました (DELETE /api/events/11/sheets/B/275/reservation )
 09/15 17:49:27 エラーが発生したため負荷レベルを上げられませんでした。2018-09-15 17:49:27.352932671 +0900 JST m=+64.048990572 リクエストがタイムアウトしました (POST /api/events/11/actions/reserve )</pre><h2>Request Summary</h2><pre class="col-md-4 prettyprint lang-sh"><small>Request by count
2432 POST /api/actions/login
1457 GET /favicon.ico
1455 GET /css/admin.css
1455 GET /css/bootstrap.min.css
1455 GET /css/layout.css
1455 GET /js/admin.js
1454 GET /js/vue.min.js
1454 GET /js/fetch.min.js
1454 GET /js/bootstrap.bundle.min.js
1454 GET /js/app.js
1454 GET /js/bootstrap-waitingfor.min.js
1454 GET /js/jquery-3.3.1.slim.min.js
1373 GET /api/events/*
1312 POST /api/events/11/actions/reserve
1258 GET /
507 DELETE /api/events/*
220 GET /admin/
219 POST /api/users
209 GET /api/users/*
183 POST /admin/api/actions/login
176 GET /admin/api/reports/events/*
82 GET /admin/api/events/*
62 POST /admin/api/events/*
42 POST /admin/api/actions/logout
42 POST /admin/api/events
41 POST /api/actions/logout
21 GET /admin/api/reports/sales
20 POST /api/events/10/actions/reserve
18 POST /api/events/0/actions/reserve

</small></pre><pre class="col-md-4 prettyprint lang-sh"><small>Request by total time
631.349 0.481211128049 POST /api/events/11/actions/reserve
159.651 0.314893491124 DELETE /api/events/*
64.163 0.0510039745628 GET /
54.772 2.60819047619 GET /admin/api/reports/sales
46.042 0.0335338674436 GET /api/events/*
45.024 0.0185131578947 POST /api/actions/login
22.224 0.10633492823 GET /api/users/*
7.59 0.0345 GET /admin/
4.722 0.0268295454545 GET /admin/api/reports/events/*
4.579 0.0209086757991 POST /api/users
4.193 0.022912568306 POST /admin/api/actions/login
1.788 0.0894 POST /api/events/10/actions/reserve
1.546 0.0858888888889 POST /api/events/0/actions/reserve
1.514 0.0244193548387 POST /admin/api/events/*
1.338 0.0163170731707 GET /admin/api/events/*
0.666 0.0158571428571 POST /admin/api/events
0.394 0.000270790378007 GET /css/bootstrap.min.css
0.331 0.00788095238095 POST /admin/api/actions/logout
0.122 0.0029756097561 POST /api/actions/logout

</small></pre><pre class="col-md-4 prettyprint lang-sh"><small>Request by out bytes
300411155 14305293 GET /admin/api/reports/sales
171531360 117890 GET /css/bootstrap.min.css
105324111 72437 GET /js/vue.min.js
86195061 59281 GET /js/bootstrap.bundle.min.js
85267116 58643 GET /js/jquery-3.3.1.slim.min.js
69789183 50829 GET /api/events/*
25400655 20191 GET /
12835282 8827 GET /js/app.js
12277651 69759 GET /admin/api/reports/events/*
10720099 7367 GET /js/admin.js
9356363 6434 GET /js/fetch.min.js
4436571 20166 GET /admin/
2972344 2044 GET /js/bootstrap-waitingfor.min.js
1773292 1217 GET /favicon.ico
1345229 553 POST /api/actions/login
1297016 891 GET /css/layout.css
1269094 872 GET /css/admin.css
550156 2632 GET /api/users/*
506208 6173 GET /admin/api/events/*
263535 200 POST /api/events/11/actions/reserve
259289 6173 POST /admin/api/events
251383 4054 POST /admin/api/events/*
68755 375 POST /admin/api/actions/login
61597 121 DELETE /api/events/*
45964 209 POST /api/users
10710 255 POST /admin/api/actions/logout
10473 255 POST /api/actions/logout
4408 220 POST /api/events/10/actions/reserve
3613 200 POST /api/events/0/actions/reserve

</small></pre><h2>MySQL Slow Queries</h2><p>mysql.txt not found.</p><h2>myprofiler</h2><pre class="prettyprint">##  2018-09-15 17:49:27.13 +0900
  37 select r.*, s.rank as sheet_rank, s.num as sheet_num, s.price as sheet_price, e.id as event_id, e.price as event_price from reservations r inner join sheets s on s.id = r.sheet_id inner join events e on e.id = r.event_id
  11 SELECT * FROM sheets ORDER BY `rank`, num
   2 SELECT COUNT(*) FROM sheets WHERE `rank` = ?
   1 SELECT SHA2(?, N)
   1 SELECT * FROM events ORDER BY id ASC
</pre><h2>CPU Profile (<a href="cpu.svg">pprof SVG</a>) (<a href="cpu-torch.svg">FlameGraph SVG</a>)</h2><pre class="prettyprint">File: torb
Type: cpu
Time: Sep 15, 2018 at 8:48am (UTC)
Duration: 1mins, Total samples = 69.66s (115.71%)
Showing nodes accounting for 57.20s, 82.11% of 69.66s total
Dropped 686 nodes (cum <= 0.35s)
      flat  flat%   sum%        cum   cum%
     7.21s 10.35% 10.35%     13.47s 19.34%  runtime.scanobject
     3.53s  5.07% 15.42%      3.95s  5.67%  runtime.findObject
     3.33s  4.78% 20.20%     13.60s 19.52%  runtime.mallocgc
     2.62s  3.76% 23.96%      2.62s  3.76%  runtime.memmove
     1.84s  2.64% 26.60%      3.40s  4.88%  runtime.mapaccess1_faststr
     1.83s  2.63% 29.23%      1.90s  2.73%  syscall.Syscall
     1.74s  2.50% 31.73%     10.35s 14.86%  database/sql.convertAssign
     1.67s  2.40% 34.12%      2.09s  3.00%  runtime.heapBitsSetType
     1.54s  2.21% 36.33%      1.55s  2.23%  time.nextStdChunk
     1.52s  2.18% 38.52%      2.77s  3.98%  runtime.greyobject
     1.29s  1.85% 40.37%      1.29s  1.85%  runtime.memclrNoHeapPointers
     1.23s  1.77% 42.13%      1.23s  1.77%  runtime.markBits.isMarked (inline)
     1.17s  1.68% 43.81%      3.18s  4.57%  time.parse
</pre><pre class="prettyprint">File: torb
Type: cpu
Time: Sep 15, 2018 at 8:48am (UTC)
Duration: 1mins, Total samples = 69.66s (115.71%)
Showing nodes accounting for 57.20s, 82.11% of 69.66s total
Dropped 686 nodes (cum <= 0.35s)
      flat  flat%   sum%        cum   cum%
         0     0%     0%     56.39s 80.95%  net/http.(*conn).serve
         0     0%     0%     55.77s 80.06%  github.com/labstack/echo.(*Echo).ServeHTTP
         0     0%     0%     55.77s 80.06%  net/http.serverHandler.ServeHTTP
         0     0%     0%     55.74s 80.02%  github.com/labstack/echo-contrib/session.MiddlewareWithConfig.func1.1
         0     0%     0%     55.73s 80.00%  github.com/labstack/echo/middleware.LoggerWithConfig.func2.1
         0     0%     0%     55.60s 79.82%  github.com/labstack/echo.(*Echo).Add.func1
         0     0%     0%     34.49s 49.51%  main.adminLoginRequired.func1
     0.24s  0.34%  0.34%     33.29s 47.79%  main.main.func20
     0.14s   0.2%  0.55%     19.57s 28.09%  runtime.systemstack
     0.03s 0.043%  0.59%     15.61s 22.41%  database/sql.withLock
     0.10s  0.14%  0.73%     15.18s 21.79%  database/sql.(*Rows).Next
     0.07s   0.1%  0.83%     13.80s 19.81%  database/sql.(*Rows).Next.func1
     0.13s  0.19%  1.02%     13.73s 19.71%  database/sql.(*Rows).nextLocked
</pre><h3>[CPU] 49.51% main.adminLoginRequired.func1</h3><pre class="prettyprint">          .    407:	}
          .    408:}
          .    409:
          .    410:func adminLoginRequired(next echo.HandlerFunc) echo.HandlerFunc {
          .    411:	return func(c echo.Context) error {
       80ms    412:		if _, err := getLoginAdministrator(c); err != nil {
          .    413:			return resError(c, "admin_login_required", 401)
          .    414:		}
     34.41s    415:		return next(c)
          .    416:	}
          .    417:}
          .    418:
          .    419:func getLoginUser(c echo.Context) (*User, error) {
          .    420:	userID := sessUserID(c)
</pre><h3>[CPU] 47.79% main.main.func20</h3><pre class="prettyprint">          .   1344:			return err
          .   1345:		}
          .   1346:		defer rows.Close()
          .   1347:
          .   1348:		var reports []Report
     11.32s   1349:		for rows.Next() {
      540ms   1350:			var reservation Reservation
      400ms   1351:			var sheet Sheet
      300ms   1352:			var event Event
      7.76s   1353:			if err := rows.Scan(&amp;reservation.ID, &amp;reservation.EventID, &amp;reservation.SheetID, &amp;reservation.UserID, &amp;reservation.ReservedAt, &amp;reservation.CanceledAt, &amp;sheet.Rank, &amp;sheet.Num, &amp;sheet.Price, &amp;event.ID, &amp;event.Price); err != nil {
          .   1354:				return err
          .   1355:			}
       10ms   1356:			report := Report{
          .   1357:				ReservationID: reservation.ID,
          .   1358:				EventID:       event.ID,
          .   1359:				Rank:          sheet.Rank,
          .   1360:				Num:           sheet.Num,
          .   1361:				UserID:        reservation.UserID,
      1.88s   1362:				SoldAt:        reservation.ReservedAt.Format("2006-01-02T15:04:05.000000Z"),
          .   1363:				Price:         event.Price + sheet.Price,
       10ms   1364:				ReservedAt:    reservation.ReservedAt.Unix(),
          .   1365:			}
          .   1366:			if reservation.CanceledAt != nil {
      1.42s   1367:				report.CanceledAt = reservation.CanceledAt.Format("2006-01-02T15:04:05.000000Z")
          .   1368:			}
      2.09s   1369:			reports = append(reports, report)
          .   1370:		}
      7.56s   1371:		return renderReportCSV(c, reports)
          .   1372:	}, adminLoginRequired)
          .   1373:
          .   1374:	e.Start(":" + appPort)
          .   1375:}
          .   1376:
</pre><h3>[CPU] 15.63% main.getEvents</h3><pre class="prettyprint">          .    437:	err := db.QueryRow("SELECT id, nickname FROM administrators WHERE id = ?", administratorID).Scan(&amp;administrator.ID, &amp;administrator.Nickname)
          .    438:	return &amp;administrator, err
          .    439:}
          .    440:
          .    441:func getEvents(all bool) ([]*Event, error) {
       40ms    442:	tx, err := db.Begin()
          .    443:	if err != nil {
          .    444:		return nil, err
          .    445:	}
          .    446:	defer tx.Commit()
          .    447:
       30ms    448:	rows, err := tx.Query("SELECT * FROM events ORDER BY id ASC")
          .    449:	if err != nil {
          .    450:		return nil, err
          .    451:	}
          .    452:	defer rows.Close()
          .    453:
       90ms    454:	rows2, err := db.Query("SELECT * FROM sheets ORDER BY `rank`, num")
          .    455:	if err != nil {
          .    456:		return nil, err
          .    457:	}
          .    458:	defer rows2.Close()
          .    459:	var sheets []*Sheet
      830ms    460:	for rows2.Next() {
      120ms    461:		var sheet Sheet
      650ms    462:		if err := rows2.Scan(&amp;sheet.ID, &amp;sheet.Rank, &amp;sheet.Num, &amp;sheet.Price); err != nil {
          .    463:			return nil, err
          .    464:		}
       40ms    465:		sheets = append(sheets, &amp;sheet)
          .    466:	}
          .    467:
          .    468:	/*
          .    469:		reservedTimes := make(map[int64]map[int64]int64)
          .    470:		rows3, err := db.Query("SELECT event_id, sheet_id, MIN(reserved_at) FROM reservations WHERE canceled_at IS NULL GROUP BY event_id, sheet_id")
          .    471:		if err != nil {
          .    472:			return nil, err
          .    473:		}
          .    474:		defer rows3.Close()
          .    475:		for rows3.Next() {
          .    476:			var eventId int64
          .    477:			var sheetId int64
          .    478:			var reservedAt *time.Time
          .    479:			rows3.Scan(&amp;eventId, &amp;sheetId, &amp;reservedAt)
          .    480:			if _, ok := reservedTimes[eventId]; !ok {
          .    481:				reservedTimes[eventId] = make(map[int64]int64)
          .    482:			}
          .    483:			reservedTimes[eventId][sheetId] = reservedAt.Unix()
          .    484:		}
          .    485:	*/
          .    486:
          .    487:	var events []*Event
       50ms    488:	for rows.Next() {
          .    489:		var event Event
       10ms    490:		if err := rows.Scan(&amp;event.ID, &amp;event.Title, &amp;event.PublicFg, &amp;event.ClosedFg, &amp;event.Price); err != nil {
          .    491:			return nil, err
          .    492:		}
          .    493:		if !all &amp;&amp; !event.PublicFg {
          .    494:			continue
          .    495:		}
          .    496:		events = append(events, &amp;event)
          .    497:	}
          .    498:	for i := range events {
          .    499:		events[i].Sheets = map[string]*Sheets{
       40ms    500:			"S": &amp;Sheets{},
          .    501:			"A": &amp;Sheets{},
          .    502:			"B": &amp;Sheets{},
          .    503:			"C": &amp;Sheets{},
          .    504:		}
          .    505:
          .    506:		for _, v := range sheets {
      2.09s    507:			sheet := *v
      920ms    508:			events[i].Sheets[sheet.Rank].Price = events[i].Price + sheet.Price
       30ms    509:			events[i].Total++
      480ms    510:			events[i].Sheets[sheet.Rank].Total++
          .    511:
          .    512:			/*
          .    513:				if a, ok := reservedTimes[events[i].ID]; ok {
          .    514:					if b, ok := a[sheet.ID]; ok {
          .    515:						sheet.Mine = false
          .    516:						sheet.Reserved = true
          .    517:						sheet.ReservedAtUnix = b
          .    518:					} else {
          .    519:						events[i].Remains++
          .    520:						events[i].Sheets[sheet.Rank].Remains++
          .    521:					}
          .    522:				} else {
          .    523:					events[i].Remains++
          .    524:					events[i].Sheets[sheet.Rank].Remains++
          .    525:				}
          .    526:			*/
      2.83s    527:			if a, ok := GetReservedTimes(events[i].ID, sheet.ID); ok {
          .    528:				sheet.Mine = false
          .    529:				sheet.Reserved = true
          .    530:				sheet.ReservedAtUnix = a
          .    531:			} else {
          .    532:				events[i].Remains++
      750ms    533:				events[i].Sheets[sheet.Rank].Remains++
          .    534:			}
      1.80s    535:			events[i].Sheets[sheet.Rank].Detail = append(events[i].Sheets[sheet.Rank].Detail, &amp;sheet)
          .    536:		}
          .    537:
          .    538:		if err != nil {
          .    539:			return nil, err
          .    540:		}
       40ms    541:		for k := range events[i].Sheets {
       10ms    542:			events[i].Sheets[k].Detail = nil
          .    543:		}
          .    544:	}
       40ms    545:	return events, nil
          .    546:}
          .    547:
          .    548:func getEvent(eventID, loginUserID int64) (*Event, error) {
          .    549:	var event Event
          .    550:	if err := db.QueryRow("SELECT * FROM events WHERE id = ?", eventID).Scan(&amp;event.ID, &amp;event.Title, &amp;event.PublicFg, &amp;event.ClosedFg, &amp;event.Price); err != nil {
</pre><h3>[CPU] 13.61% main.fillinUser.func1</h3><pre class="prettyprint">          .    660:	return &amp;sanitized
          .    661:}
          .    662:
          .    663:func fillinUser(next echo.HandlerFunc) echo.HandlerFunc {
          .    664:	return func(c echo.Context) error {
       30ms    665:		if user, err := getLoginUser(c); err == nil {
          .    666:			c.Set("user", user)
          .    667:		}
      9.45s    668:		return next(c)
          .    669:	}
          .    670:}
          .    671:
          .    672:func fillinAdministrator(next echo.HandlerFunc) echo.HandlerFunc {
          .    673:	return func(c echo.Context) error {
</pre><h3>[CPU] 13.57% main.main.func2</h3><pre class="prettyprint">          .    736:	}
          .    737:	e.Use(session.Middleware(sessions.NewCookieStore([]byte("secret"))))
          .    738:	e.Use(middleware.LoggerWithConfig(middleware.LoggerConfig{Output: os.Stderr}))
          .    739:	e.Static("/", "public")
          .    740:	e.GET("/", func(c echo.Context) error {
      9.07s    741:		events, err := getEvents(false)
          .    742:		if err != nil {
          .    743:			return err
          .    744:		}
          .    745:		for i, v := range events {
          .    746:			events[i] = sanitizeEvent(v)
          .    747:		}
      370ms    748:		return c.Render(200, "index.tmpl", echo.Map{
       10ms    749:			"events": events,
          .    750:			"user":   c.Get("user"),
          .    751:			"origin": c.Scheme() + "://" + c.Request().Host,
          .    752:		})
          .    753:	}, fillinUser)
          .    754:	e.GET("/initialize", func(c echo.Context) error {
</pre><h2>MEM Profile (<a href="mem.svg">pprof SVG</a>) (<a href="mem-torch.svg">FlameGraph SVG</a>)</h2><pre class="prettyprint">File: torb
Type: inuse_space
Time: Sep 15, 2018 at 8:49am (UTC)
Showing nodes accounting for 184.52MB, 99.46% of 185.53MB total
Dropped 15 nodes (cum <= 0.93MB)
      flat  flat%   sum%        cum   cum%
   47.16MB 25.42% 25.42%    47.16MB 25.42%  bytes.makeSlice
   42.38MB 22.84% 48.26%   144.04MB 77.64%  main.main.func20
   23.28MB 12.55% 60.81%    36.28MB 19.56%  main.InitReservation
      22MB 11.86% 72.67%       22MB 11.86%  time.Time.Format
      18MB  9.70% 82.37%       18MB  9.70%  fmt.Sprintf
   14.50MB  7.82% 90.19%    79.66MB 42.94%  main.renderReportCSV
   13.50MB  7.28% 97.46%    13.50MB  7.28%  reflect.New
    1.16MB  0.62% 98.09%     1.16MB  0.62%  runtime/pprof.StartCPUProfile
    1.04MB  0.56% 98.65%     1.04MB  0.56%  main.InitReservedTime
    1.01MB  0.54% 99.19%     1.01MB  0.54%  runtime/pprof.(*profMap).lookup
    0.50MB  0.27% 99.46%       14MB  7.55%  database/sql.convertAssign
         0     0% 99.46%    47.16MB 25.42%  bytes.(*Buffer).WriteString
         0     0% 99.46%    47.16MB 25.42%  bytes.(*Buffer).grow
         0     0% 99.46%       14MB  7.55%  database/sql.(*Rows).Scan
</pre><pre class="prettyprint">File: torb
Type: inuse_space
Time: Sep 15, 2018 at 8:49am (UTC)
Showing nodes accounting for 184.52MB, 99.46% of 185.53MB total
Dropped 15 nodes (cum <= 0.93MB)
      flat  flat%   sum%        cum   cum%
         0     0%     0%   184.02MB 99.18%  github.com/labstack/echo-contrib/session.MiddlewareWithConfig.func1.1
         0     0%     0%   184.02MB 99.18%  github.com/labstack/echo.(*Echo).Add.func1
         0     0%     0%   184.02MB 99.18%  github.com/labstack/echo.(*Echo).ServeHTTP
         0     0%     0%   184.02MB 99.18%  github.com/labstack/echo/middleware.LoggerWithConfig.func2.1
         0     0%     0%   184.02MB 99.18%  net/http.(*conn).serve
         0     0%     0%   184.02MB 99.18%  net/http.serverHandler.ServeHTTP
         0     0%     0%   144.04MB 77.64%  main.adminLoginRequired.func1
   42.38MB 22.84% 22.84%   144.04MB 77.64%  main.main.func20
   14.50MB  7.82% 30.66%    79.66MB 42.94%  main.renderReportCSV
         0     0% 30.66%    47.16MB 25.42%  bytes.(*Buffer).WriteString
         0     0% 30.66%    47.16MB 25.42%  bytes.(*Buffer).grow
   47.16MB 25.42% 56.07%    47.16MB 25.42%  bytes.makeSlice
         0     0% 56.07%    38.98MB 21.01%  main.main.func3
         0     0% 56.07%    37.82MB 20.39%  main.InitCache
</pre><h3>[MEM] 77.64% main.adminLoginRequired.func1</h3><pre class="prettyprint">          .    410:func adminLoginRequired(next echo.HandlerFunc) echo.HandlerFunc {
          .    411:	return func(c echo.Context) error {
          .    412:		if _, err := getLoginAdministrator(c); err != nil {
          .    413:			return resError(c, "admin_login_required", 401)
          .    414:		}
   144.04MB    415:		return next(c)
          .    416:	}
          .    417:}
          .    418:
          .    419:func getLoginUser(c echo.Context) (*User, error) {
          .    420:	userID := sessUserID(c)
</pre><h3>[MEM] 77.64% main.main.func20</h3><pre class="prettyprint">          .   1357:				ReservationID: reservation.ID,
          .   1358:				EventID:       event.ID,
          .   1359:				Rank:          sheet.Rank,
          .   1360:				Num:           sheet.Num,
          .   1361:				UserID:        reservation.UserID,
        8MB   1362:				SoldAt:        reservation.ReservedAt.Format("2006-01-02T15:04:05.000000Z"),
          .   1363:				Price:         event.Price + sheet.Price,
          .   1364:				ReservedAt:    reservation.ReservedAt.Unix(),
          .   1365:			}
          .   1366:			if reservation.CanceledAt != nil {
       14MB   1367:				report.CanceledAt = reservation.CanceledAt.Format("2006-01-02T15:04:05.000000Z")
          .   1368:			}
    42.38MB   1369:			reports = append(reports, report)
          .   1370:		}
    79.66MB   1371:		return renderReportCSV(c, reports)
          .   1372:	}, adminLoginRequired)
          .   1373:
          .   1374:	e.Start(":" + appPort)
          .   1375:}
          .   1376:
</pre><h3>[MEM] 42.94% main.renderReportCSV</h3><pre class="prettyprint">          .   1389:func renderReportCSV(c echo.Context, reports []Report) error {
          .   1390:	sort.Slice(reports, func(i, j int) bool { return reports[i].ReservedAt &lt; reports[j].ReservedAt })
          .   1391:
          .   1392:	body := bytes.NewBufferString("reservation_id,event_id,rank,num,price,user_id,sold_at,canceled_at\n")
          .   1393:	for _, v := range reports {
    65.16MB   1394:		body.WriteString(fmt.Sprintf("%d,%d,%s,%d,%d,%d,%s,%s\n",
    14.50MB   1395:			v.ReservationID, v.EventID, v.Rank, v.Num, v.Price, v.UserID, v.SoldAt, v.CanceledAt))
          .   1396:	}
          .   1397:
          .   1398:	c.Response().Header().Set("Content-Type", `text/csv; charset=UTF-8`)
          .   1399:	c.Response().Header().Set("Content-Disposition", `attachment; filename="report.csv"`)
          .   1400:	_, err := io.Copy(c.Response(), body)
</pre><h2>BLOCK Profile (<a href="block.svg">pprof SVG</a>) (<a href="block-torch.svg">FlameGraph SVG</a>)</h2><pre class="prettyprint">File: torb
Type: delay
Time: Sep 15, 2018 at 8:49am (UTC)
Showing nodes accounting for 1281.30s, 100% of 1281.73s total
Dropped 59 nodes (cum <= 6.41s)
      flat  flat%   sum%        cum   cum%
   799.82s 62.40% 62.40%    799.82s 62.40%  sync.(*Mutex).Lock
   416.60s 32.50% 94.90%    416.60s 32.50%  runtime.selectgo
    64.88s  5.06%   100%     64.88s  5.06%  runtime.chanrecv1
         0     0%   100%     50.93s  3.97%  database/sql.(*DB).connectionResetter
         0     0%   100%     21.55s  1.68%  database/sql.(*Rows).awaitDone
         0     0%   100%     64.64s  5.04%  database/sql.(*Tx).awaitDone
         0     0%   100%    344.12s 26.85%  github.com/go-sql-driver/mysql.(*mysqlConn).startWatcher.func1
         0     0%   100%    799.82s 62.40%  github.com/labstack/echo-contrib/session.MiddlewareWithConfig.func1.1
         0     0%   100%    799.82s 62.40%  github.com/labstack/echo.(*Echo).Add.func1
         0     0%   100%    799.82s 62.40%  github.com/labstack/echo.(*Echo).ServeHTTP
         0     0%   100%    799.82s 62.40%  github.com/labstack/echo/middleware.LoggerWithConfig.func2.1
         0     0%   100%    797.12s 62.19%  main.loginRequired.func1
         0     0%   100%    642.70s 50.14%  main.main.func10
         0     0%   100%    154.21s 12.03%  main.main.func11
</pre><pre class="prettyprint">File: torb
Type: delay
Time: Sep 15, 2018 at 8:49am (UTC)
Showing nodes accounting for 1281.30s, 100% of 1281.73s total
Dropped 59 nodes (cum <= 6.41s)
      flat  flat%   sum%        cum   cum%
         0     0%     0%    800.25s 62.43%  net/http.(*conn).serve
   799.82s 62.40% 62.40%    799.82s 62.40%  sync.(*Mutex).Lock
         0     0% 62.40%    799.82s 62.40%  github.com/labstack/echo-contrib/session.MiddlewareWithConfig.func1.1
         0     0% 62.40%    799.82s 62.40%  github.com/labstack/echo.(*Echo).ServeHTTP
         0     0% 62.40%    799.82s 62.40%  net/http.serverHandler.ServeHTTP
         0     0% 62.40%    799.82s 62.40%  github.com/labstack/echo/middleware.LoggerWithConfig.func2.1
         0     0% 62.40%    799.82s 62.40%  github.com/labstack/echo.(*Echo).Add.func1
         0     0% 62.40%    797.12s 62.19%  main.loginRequired.func1
         0     0% 62.40%    642.70s 50.14%  main.main.func10
   416.60s 32.50% 94.90%    416.60s 32.50%  runtime.selectgo
         0     0% 94.90%    344.12s 26.85%  github.com/go-sql-driver/mysql.(*mysqlConn).startWatcher.func1
         0     0% 94.90%    154.21s 12.03%  main.main.func11
    64.88s  5.06%   100%     64.88s  5.06%  runtime.chanrecv1
         0     0%   100%     64.64s  5.04%  database/sql.(*Tx).awaitDone
</pre><h3>[BLOCK] 62.19% main.loginRequired.func1</h3><pre class="prettyprint">          .    398:	sess.Save(c.Request(), c.Response())
          .    399:}
          .    400:
          .    401:func loginRequired(next echo.HandlerFunc) echo.HandlerFunc {
          .    402:	return func(c echo.Context) error {
    84.53ms    403:		if _, err := getLoginUser(c); err != nil {
          .    404:			return resError(c, "login_required", 401)
          .    405:		}
  13.28mins    406:		return next(c)
          .    407:	}
          .    408:}
          .    409:
          .    410:func adminLoginRequired(next echo.HandlerFunc) echo.HandlerFunc {
          .    411:	return func(c echo.Context) error {
</pre><h3>[BLOCK] 50.14% main.main.func10</h3><pre class="prettyprint">          .    994:			return resError(c, "not_found", 404)
          .    995:		}
          .    996:		return c.JSON(200, sanitizeEvent(event))
          .    997:	})
          .    998:	e.POST("/api/events/:id/actions/reserve", func(c echo.Context) error {
  10.71mins    999:		reqMtx.Lock()
          .   1000:		defer reqMtx.Unlock()
          .   1001:
          .   1002:		eventID, err := strconv.ParseInt(c.Param("id"), 10, 64)
          .   1003:		if err != nil {
          .   1004:			return resError(c, "not_found", 404)
          .   1005:		}
          .   1006:		var params struct {
          .   1007:			Rank string `json:"sheet_rank"`
          .   1008:		}
          .   1009:		c.Bind(&amp;params)
          .   1010:
   742.70us   1011:		user, err := getLoginUser(c)
          .   1012:		if err != nil {
          .   1013:			return err
          .   1014:		}
          .   1015:
   130.57ms   1016:		event, err := getEvent(eventID, user.ID)
          .   1017:		if err != nil {
          .   1018:			if err == sql.ErrNoRows {
          .   1019:				return resError(c, "invalid_event", 404)
          .   1020:			}
          .   1021:			return err
          .   1022:		} else if !event.PublicFg {
          .   1023:			return resError(c, "invalid_event", 404)
          .   1024:		}
          .   1025:
   166.82ms   1026:		if !validateRank(params.Rank) {
          .   1027:			return resError(c, "invalid_rank", 400)
          .   1028:		}
          .   1029:
          .   1030:		var sheet Sheet
          .   1031:		var reservationID int64
          .   1032:		for {
    34.46ms   1033:			if err := db.QueryRow("SELECT * FROM sheets WHERE id NOT IN (SELECT sheet_id FROM reservations WHERE event_id = ? AND canceled_at IS NULL) AND `rank` = ? ORDER BY RAND() LIMIT 1", event.ID, params.Rank).Scan(&amp;sheet.ID, &amp;sheet.Rank, &amp;sheet.Num, &amp;sheet.Price); err != nil {
          .   1034:				if err == sql.ErrNoRows {
          .   1035:					return resError(c, "sold_out", 409)
          .   1036:				}
          .   1037:				return err
          .   1038:			}
          .   1039:
    38.11ms   1040:			tx, err := db.Beginx()
          .   1041:			if err != nil {
          .   1042:				return err
          .   1043:			}
          .   1044:
          .   1045:			res, err := tx.Exec("INSERT INTO reservations (event_id, sheet_id, user_id, reserved_at) VALUES (?, ?, ?, ?)", event.ID, sheet.ID, user.ID, time.Now().UTC().Format("2006-01-02 15:04:05.000000"))
          .   1046:			if err != nil {
          .   1047:				tx.Rollback()
          .   1048:				log.Println("re-try: rollback by", err)
          .   1049:				continue
          .   1050:			}
          .   1051:			reservationID, err = res.LastInsertId()
          .   1052:			if err != nil {
          .   1053:				tx.Rollback()
          .   1054:				log.Println("re-try: rollback by", err)
          .   1055:				continue
          .   1056:			}
          .   1057:
          .   1058:			var reserv Reservation
          .   1059:			err = tx.Get(&amp;reserv, "SELECT * FROM `reservations` WHERE id = ?", reservationID)
          .   1060:			if err != nil {
          .   1061:				tx.Rollback()
          .   1062:				log.Println("re-try: rollback by", err)
          .   1063:				continue
          .   1064:			}
          .   1065:
          .   1066:			if err := tx.Commit(); err != nil {
          .   1067:				tx.Rollback()
          .   1068:				log.Println("re-try: rollback by", err)
          .   1069:				continue
          .   1070:			}
          .   1071:
    27.01ms   1072:			AddReservation(&amp;reserv)
          .   1073:
          .   1074:			break
          .   1075:		}
          .   1076:		return c.JSON(202, echo.Map{
          .   1077:			"id":         reservationID,
</pre><h3>[BLOCK] 12.03% main.main.func11</h3><pre class="prettyprint">          .   1078:			"sheet_rank": params.Rank,
          .   1079:			"sheet_num":  sheet.Num,
          .   1080:		})
          .   1081:	}, loginRequired)
          .   1082:	e.DELETE("/api/events/:id/sheets/:rank/:num/reservation", func(c echo.Context) error {
   2.57mins   1083:		reqMtx.Lock()
          .   1084:		defer reqMtx.Unlock()
          .   1085:
          .   1086:		eventID, err := strconv.ParseInt(c.Param("id"), 10, 64)
          .   1087:		if err != nil {
          .   1088:			return resError(c, "not_found", 404)
          .   1089:		}
          .   1090:		rank := c.Param("rank")
          .   1091:		num := c.Param("num")
          .   1092:
     1.65us   1093:		user, err := getLoginUser(c)
          .   1094:		if err != nil {
          .   1095:			return err
          .   1096:		}
          .   1097:
    38.62ms   1098:		event, err := getEvent(eventID, user.ID)
          .   1099:		if err != nil {
          .   1100:			if err == sql.ErrNoRows {
          .   1101:				return resError(c, "invalid_event", 404)
          .   1102:			}
          .   1103:			return err
          .   1104:		} else if !event.PublicFg {
          .   1105:			return resError(c, "invalid_event", 404)
          .   1106:		}
          .   1107:
    32.73ms   1108:		if !validateRank(rank) {
          .   1109:			return resError(c, "invalid_rank", 404)
          .   1110:		}
          .   1111:
          .   1112:		var sheet Sheet
     7.90ms   1113:		if err := db.QueryRow("SELECT * FROM sheets WHERE `rank` = ? AND num = ?", rank, num).Scan(&amp;sheet.ID, &amp;sheet.Rank, &amp;sheet.Num, &amp;sheet.Price); err != nil {
          .   1114:			if err == sql.ErrNoRows {
          .   1115:				return resError(c, "invalid_sheet", 404)
          .   1116:			}
          .   1117:			return err
          .   1118:		}
          .   1119:
     2.60ms   1120:		tx, err := db.Begin()
          .   1121:		if err != nil {
          .   1122:			return err
          .   1123:		}
          .   1124:
          .   1125:		// TODO SELECT消したい
          .   1126:		var reservation Reservation
          .   1127:		if err := tx.QueryRow("SELECT * FROM reservations WHERE event_id = ? AND sheet_id = ? AND canceled_at IS NULL GROUP BY event_id HAVING reserved_at = MIN(reserved_at)", event.ID, sheet.ID).Scan(&amp;reservation.ID, &amp;reservation.EventID, &amp;reservation.SheetID, &amp;reservation.UserID, &amp;reservation.ReservedAt, &amp;reservation.CanceledAt); err != nil {
          .   1128:			tx.Rollback()
          .   1129:			if err == sql.ErrNoRows {
          .   1130:				return resError(c, "not_reserved", 400)
          .   1131:			}
          .   1132:			return err
          .   1133:		}
          .   1134:		if reservation.UserID != user.ID {
          .   1135:			tx.Rollback()
          .   1136:			return resError(c, "not_permitted", 403)
          .   1137:		}
          .   1138:
          .   1139:		cancelTime := time.Now().UTC()
          .   1140:		if _, err := tx.Exec("UPDATE reservations SET canceled_at = ? WHERE id = ?", cancelTime.Format("2006-01-02 15:04:05.000000"), reservation.ID); err != nil {
          .   1141:			tx.Rollback()
          .   1142:			return err
          .   1143:		}
          .   1144:
          .   1145:		if err := tx.Commit(); err != nil {
          .   1146:			return err
          .   1147:		}
          .   1148:
      474ns   1149:		CancelReservation(GetReservation(reservation.ID), cancelTime)
          .   1150:
          .   1151:		return c.NoContent(204)
          .   1152:	}, loginRequired)
          .   1153:	e.GET("/admin/", func(c echo.Context) error {
          .   1154:		var events []*Event
</pre>
  </div>
  </body>
</html>
